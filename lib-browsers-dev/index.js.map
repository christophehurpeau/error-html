{"version":3,"sources":["../src/index.js"],"names":["tag","tagName","attributes","content","contentEscape","str","Object","keys","forEach","key","HtmlRenderer","options","assign","fileProtocol","filePath","lineNumber","columnNumber","generatedPath","sourcePath","startsWith","substr","length","appPath","error","name","message","production","renderStack","frames","console","log","frame","i","file","contents","isNative","isEval","fileName","openLocalFile","replaceAppInFilePath","functionName","typeName","methodName","highlightLine","stack","withLineNumbers","minmax","hcontents","err","split","ok","firstLine","start","lineContent","end","Math","max","slice","lines","line","style","startNumber","_lines","contentLine"],"mappings":"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","file":"index.js","sourcesContent":["/* eslint-disable max-len, max-lines */\n\nimport escape from 'escape-html';\nimport highlight from 'eshighlight-fb';\nimport parseErrorStack from './parseErrorStack';\n\nfunction tag(tagName, attributes, content, contentEscape) {\n  attributes = attributes || {};\n  let str = '';\n  Object.keys(attributes).forEach(key => {\n    str += ` ${key}`;\n    if (attributes[key]) {\n      str += `=\"${attributes[key] === true ? key : escape(attributes[key])}\"`;\n    }\n  });\n\n  return `<${tagName}${str}${content == null ? '/' :\n                  `>${contentEscape ? escape(content) : content}</${tagName}`}>`;\n}\n\nexport default class HtmlRenderer {\n  constructor(options) {\n    this.options = Object.assign({\n      fileProtocol: 'file',\n    }, options);\n  }\n\n  /**\n   * @ignore\n   */\n  openLocalFile(filePath, lineNumber, columnNumber) {\n    if (this.generatedPath && this.sourcePath && filePath.startsWith(this.generatedPath)) {\n      filePath = this.sourcePath + filePath.substr(this.generatedPath.length);\n    }\n\n    return `<a download href=\"${this.options.fileProtocol}://${escape(filePath)}`\n               + `${!lineNumber ? '' : `?${lineNumber}${!columnNumber ? '' : `:${columnNumber}`}`}\">`;\n  }\n\n  /**\n   * @ignore\n   */\n  replaceAppInFilePath(filePath) {\n    if (!filePath) return 'unknown';\n\n    if (this.appPath) {\n      filePath = `APP/${filePath.substr(this.appPath.length)}`;\n    }\n\n    return filePath;\n  }\n\n  /**\n   * @ignore\n   */\n  render(error) {\n    let str = '<div style=\"text-align: left\">';\n    str += `<h1>${error.name}</h1>\\n`;\n    if (error.message) {\n      str += '<pre style=\"background:#FFF;color:#222;border:0;font-size:1em;white-space:pre-wrap;word-wrap:break-word\">';\n      str += escape(error.message);\n      str += '</pre>';\n    }\n\n    str += '<h5 style=\"background:#FFDDAA;color:#333;border:1px solid #E07308;padding:1px 2px;\">Call Stack:</h5>\\n';\n\n    if (!this.options.production) {\n      str += `<pre style=\"background:#FFF;color:#222;border:0\">${this.renderStack(error)}</pre>`;\n    }\n\n    return str;\n  }\n\n  /**\n   * @ignore\n   */\n  renderStack(error) {\n    let frames = parseErrorStack(error);\n    console.log(frames);\n\n    let str = `<style>.string{ color: #EC7600; }\n.keyword, .null{ font-weight: bold; color: #93C763; }\n.numeric{ color: #FACD22; }\n.line-comment{ color: #66747B; }\n.identifier{ }\n.control-flow{ color: #93C763; }\n.azerty1{ color: #66747B; }\n.azerty2{ color: #678CB1; }\n.azerty5{ color: #F1F2F3; }\n.azerty6{ color: #8AC763; }\n.azerty7{ color: #E0E2E4; }\n.azerty9{ color: purple; }\n</style>`;\n    frames.forEach((frame, i) => {\n      if ((frame.file && frame.file.contents)) {\n        str += '<span><a href=\"javascript:;\" style=\"color:#CC7A00;text-decoration:none;outline:none;\" '\n            // eslint-disable-next-line\n            + `onclick=\"var el=this.parentNode.nextElementSibling; el.style.display=el.style.display=='none'?'block':'none';\">`;\n      }\n\n      str += `#${i} `;\n      if (!frame.isNative && !frame.isEval) {\n        if (frame.fileName && frame.fileName.startsWith('/')) {\n          str += this.openLocalFile(frame.fileName, frame.lineNumber, frame.columnNumber);\n        }\n\n        str += this.replaceAppInFilePath(frame.fileName);\n        if (frame.lineNumber !== null || frame.columnNumber !== null) {\n          str += `:${frame.lineNumber}:${frame.columnNumber}`;\n        }\n\n        if (frame.fileName && frame.fileName.startsWith('/')) {\n          str += '</a>';\n        }\n\n        str += ' ';\n      }\n\n      if (frame.functionName) {\n        str += frame.functionName;\n      } else if (frame.typeName) {\n        str += `${frame.typeName}.${frame.methodName || '<anonymous>'}`;\n      }\n\n      if (frame.isNative) {\n        str += ' [native]';\n      }\n\n      if (frame.isEval) {\n        str += ' [eval]';\n      }\n\n      if ((frame.file && frame.file.contents)) {\n        str += '</a></span>';\n        str += '<div style=\"display:none\">';\n\n        str += '<div style=\"margin-top: 5px\">';\n        str += '<b>File content :</b><br />';\n        str += this.highlightLine(frame.file.contents, frame.lineNumber, frame.columnNumber);\n        str += '</div>';\n\n        str += '</div>';\n      }\n\n      str += '\\n';\n    });\n\n    str += '\\n';\n    str += '\\n';\n    str += error.stack;\n\n    return str;\n  }\n\n  /**\n   * @ignore\n   */\n  highlightLine(contents, lineNumber /* , columnNumber */) {\n    let style = 'background:#3F1F1F;';\n    let withLineNumbers = true;\n    let minmax = 4;\n\n    let hcontents;\n    try {\n      hcontents = highlight(contents);\n    } catch (err) {\n      hcontents = escape(contents);\n    }\n\n    hcontents = hcontents.split(/\\r\\n|\\n\\r|\\n|\\r/);\n\n    let ok = lineNumber <= hcontents.length;\n    let firstLine;\n    let start;\n    let lineContent;\n    let end;\n\n    if (ok) {\n      firstLine = Math.max(0, minmax ? lineNumber - 1 - minmax : 0);\n      start = hcontents.slice(firstLine, lineNumber - 1);\n      lineContent = lineNumber === 0 ? '' : hcontents[lineNumber - 1];\n      end = hcontents.slice(lineNumber, lineNumber + minmax);\n    } else {\n      start = hcontents;\n    }\n\n        /* if (withLineNumbers) {\n            // $withLineNumbers = '%'.strlen((string)($ok ? $line+$minmax : $minmax+1)).'d';\n        } */\n\n    let content = this.lines(withLineNumbers, ok ? firstLine + 1 : 1, start);\n    if (ok) {\n      let attributes = { style };\n      content += this.line(withLineNumbers, lineNumber, attributes, lineContent);\n      content += this.lines(withLineNumbers, lineNumber + 1, end);\n    }\n\n    let preAttrs = { style: 'background:#0F0F0F;color:#E0E2E4;border:0;padding:0;position:relative;' };\n    return tag('pre', preAttrs, content, false);\n  }\n\n  /**\n   * @ignore\n   */\n  lines(withLineNumbers, startNumber, _lines) {\n    let content = '';\n    _lines.forEach((line) => {\n      content += this.line(withLineNumbers, startNumber + 1, {}, line);\n    });\n    return content;\n  }\n\n  /**\n   * @ignore\n   */\n  line(withLineNumbers, lineNumber, attributes, contentLine) {\n    attributes.style = `${attributes.style || ''}white-space:pre-wrap;`\n            + `${withLineNumbers ? 'padding-left:20px;' : ''}`;\n\n    if (withLineNumbers) {\n      contentLine = '<i style=\"color:#AAA;font-size:7pt;position:absolute;left:1px;padding-top:1px;\">'\n                            + `${lineNumber}</i>${contentLine}`;\n    }\n\n    return tag('div', attributes, contentLine);\n  }\n}\n"]}